<!DOCTYPE html> 
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GeoGuard Pro - Глобальний моніторинг</title>
  <!-- Підключення зовнішніх бібліотек -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/aos@2.3.4/dist/aos.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.0/chart.min.js"></script>
  <script src="https://api.ipify.org?format=jsonp&callback=getIP"></script>
  <style>
    :root {
      --primary-color: #2563eb;
      --primary-dark: #1e40af;
      --warning-color: #eab308;
      --danger-color: #dc2626;
      --success-color: #16a34a;
      --bg-color-light: #f8fafc;
      --card-bg-light: #ffffff;
      --text-light: #1e293b;
      --bg-color-dark: #1e293b;
      --card-bg-dark: #374151;
      --text-dark: #f8fafc;
      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      --border-radius: 1rem;
    }
    
    /* Початкові стилі (світла тема за замовчуванням) */
    body {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Inter', system-ui, sans-serif;
      background-color: var(--bg-color-light);
      color: var(--text-light);
      line-height: 1.6;
      transition: var(--transition);
      overflow-x: hidden;
    }
    
    /* Темна тема */
    body.dark {
      background-color: var(--bg-color-dark);
      color: var(--text-dark);
    }
    
    a {
      text-decoration: none;
      color: inherit;
    }
    
    .container {
      max-width: 1440px;
      margin: 0 auto;
      padding: 20px;
    }
    
    /* Заголовок */
    header.header {
      background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
      color: white;
      padding: 2rem 0;
      margin-bottom: 2rem;
      position: relative;
      overflow: hidden;
      box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
    }
    
    header.header::after {
      content: '';
      position: absolute;
      bottom: -50px;
      left: 0;
      width: 100%;
      height: 100px;
      background: var(--bg-color-light);
      transform: skewY(-3deg);
      z-index: 0;
      transition: var(--transition);
    }
    
    body.dark header.header::after {
      background: var(--bg-color-dark);
    }
    
    .header-content {
      position: relative;
      z-index: 1;
    }
    
    .header h1 {
      font-size: 2.5rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }
    
    .logo-icon {
      font-size: 1.8rem;
      color: rgba(255, 255, 255, 0.9);
    }
    
    .tagline {
      color: rgba(255, 255, 255, 0.85);
      margin-top: 0.5rem;
      font-size: 1.1rem;
    }
    
    .last-updated {
      margin-top: 1rem;
      font-size: 0.9rem;
      color: rgba(255, 255, 255, 0.8);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    /* Секція аутентифікації */
    .auth-section {
      position: absolute;
      top: 20px;
      right: 20px;
      display: flex;
      gap: 1rem;
      z-index: 100;
    }
    
    .auth-btn {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(5px);
      padding: 0.75rem 1.5rem;
      border-radius: 50px;
      transition: var(--transition);
      color: white;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .auth-btn:hover {
      background: rgba(255, 255, 255, 0.2);
    }
    
    /* Фільтри катастроф */
    .disaster-filters {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 1rem;
      margin-bottom: 2rem;
    }
    
    .filter-card {
      padding: 1.25rem;
      border-radius: var(--border-radius);
      background: var(--card-bg-light);
      cursor: pointer;
      transition: transform 0.3s, box-shadow 0.3s, background-color 0.3s;
      border: 2px solid #e2e8f0;
      display: flex;
      align-items: center;
      position: relative;
      font-weight: 600;
    }
    
    body.dark .filter-card {
      background: var(--card-bg-dark);
      border-color: #4b5563;
    }
    
    .filter-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0,0,0,0.2);
    }
    
    .filter-card:focus {
      outline: 2px dashed var(--primary-color);
      outline-offset: 4px;
    }
    
    .filter-card span {
      margin-left: 10px;
    }
    
    .filter-card.active {
      border-color: var(--primary-color);
      background: rgba(37, 99, 235, 0.05);
    }
    
    .filter-card.active::after {
      content: '✓';
      position: absolute;
      top: -10px;
      right: -10px;
      background: var(--primary-color);
      color: white;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.9rem;
    }
    
    .filter-icon {
      width: 50px;
      height: 50px;
      border-radius: 0.75rem;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
    }
    
    /* Стилі для катастроф */
    .earthquake { background: rgba(239, 68, 68, 0.1); color: #dc2626; }
    .flood { background: rgba(59, 130, 246, 0.1); color: #2563eb; }
    .volcano { background: rgba(245, 158, 11, 0.1); color: #eab308; }
    .wildfire { background: rgba(249, 115, 22, 0.1); color: #f97316; }
    
    /* Період відстеження */
    .period-filter {
      background-color: var(--card-bg-light);
      border-radius: var(--border-radius);
      padding: 1.5rem;
      box-shadow: 0 10px 15px -3px rgba(0,0,0,0.05);
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
    }
    
    body.dark .period-filter {
      background-color: var(--card-bg-dark);
      box-shadow: 0 10px 15px -3px rgba(0,0,0,0.3);
    }
    
    .period-filter h3 {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      font-weight: 600;
    }
    
    .period-filter h3 i {
      color: var(--primary-color);
      font-size: 1.25rem;
    }
    
    .period-selector {
      appearance: none;
      background-color: var(--bg-color-light);
      border: 2px solid var(--primary-color);
      color: var(--text-light);
      padding: 0.75rem 1.5rem;
      border-radius: 0.75rem;
      font-weight: 500;
      cursor: pointer;
      transition: var(--transition);
      position: relative;
    }
    
    body.dark .period-selector {
      background-color: var(--bg-color-dark);
      color: var(--text-dark);
    }
    
    .period-selector:hover {
      border-color: var(--primary-dark);
      background-color: rgba(37, 99, 235, 0.05);
    }
    
    .period-selector::after {
      content: '▼';
      position: absolute;
      right: 15px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--primary-color);
      pointer-events: none;
    }
    
    /* Кнопка оновлення */
    #refresh-button {
      padding: 0.4rem 0.8rem;
      background-color: #4CAF50;
      color: white;
      font-size: 0.8rem;
      border: none;
      border-radius: 20px;
      box-shadow: 0 3px 6px rgba(0, 0, 0, 0.15);
      transition: transform 0.2s, background-color 0.3s, box-shadow 0.3s;
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }
    
    #refresh-button:hover {
      background-color: #45a049;
      transform: translateY(-3px);
      box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
    }
    
    #refresh-button:active {
      transform: translateY(1px);
      box-shadow: 0 3px 6px rgba(0, 0, 0, 0.15);
    }
    
    /* Індикатори катастроф */
    .disaster-indicators {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }
    
    .indicator-card {
      padding: 1.5rem;
      border-radius: var(--border-radius);
      background: var(--card-bg-light);
      position: relative;
      overflow: hidden;
      transition: transform 0.3s, box-shadow 0.3s;
      box-shadow: 0 4px 8px rgba(0,0,0,0.05);
    }
    
    body.dark .indicator-card {
      background: var(--card-bg-dark);
      box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    }
    
    .indicator-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 24px rgba(0,0,0,0.2);
    }
    
    .indicator-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 4px;
      background: var(--primary-color);
      transform: scaleX(0);
      transition: transform 0.3s ease;
    }
    
    .indicator-card.critical::before {
      background: var(--danger-color);
      transform: scaleX(1);
    }
    
    .indicator-header {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1rem;
    }
    
    .indicator-icon {
      width: 50px;
      height: 50px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
    }
    
    /* Мапа */
    .map-container {
      height: 400px;
      border-radius: var(--border-radius);
      overflow: hidden;
      margin: 2rem 0;
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.05);
    }
    
    /* Анімація пульсації для сповіщень */
    .alert-pulse {
      animation: pulse 1.5s infinite;
    }
    
    @keyframes pulse {
      0% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.05); opacity: 0.7; }
      100% { transform: scale(1); opacity: 1; }
    }
    
    /* Стрічка подій */
    .disaster-timeline {
      display: flex;
      gap: 1rem;
      overflow-x: auto;
      padding: 1rem 0;
    }
    
    .timeline-event {
      min-width: 200px;
      padding: 1rem;
      border-radius: 0.75rem;
      background: var(--card-bg-light);
      position: relative;
      box-shadow: 0 4px 8px rgba(0,0,0,0.05);
      transition: transform 0.3s, box-shadow 0.3s;
    }
    
    body.dark .timeline-event {
      background: var(--card-bg-dark);
      box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    }
    
    .timeline-event:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 16px rgba(0,0,0,0.2);
    }
    
    .notification-badge {
      position: absolute;
      top: -10px;
      right: -10px;
      background: var(--danger-color);
      color: white;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
    }
    
    /* Статистика */
    .stats-section {
      margin: 2rem 0;
      background: var(--card-bg-light);
      border-radius: var(--border-radius);
      padding: 2rem;
      box-shadow: 0 10px 15px -3px rgba(0,0,0,0.05);
    }
    
    body.dark .stats-section {
      background: var(--card-bg-dark);
      box-shadow: 0 10px 15px -3px rgba(0,0,0,0.3);
    }
    
    .stats-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
    }
    
    .stats-chart-container {
      height: 400px;
      position: relative;
    }
    
    /* Додаткова інформація */
    .additional-info {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 2rem;
      margin: 2rem 0;
    }
    
    .ip-geolocation {
      background: var(--card-bg-light);
      padding: 1.5rem;
      border-radius: var(--border-radius);
      box-shadow: 0 10px 15px -3px rgba(0,0,0,0.05);
    }
    
    body.dark .ip-geolocation {
      background: var(--card-bg-dark);
      box-shadow: 0 10px 15px -3px rgba(0,0,0,0.3);
    }
    
    .ip-geolocation h2 {
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    #network-info p {
      margin: 0.5rem 0;
      padding: 0.5rem;
      background: rgba(37, 99, 235, 0.05);
      border-radius: 0.5rem;
    }
    
    /* Повідомлення про оновлення */
    #update-notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background: linear-gradient(135deg, #6e7dff, #5363f7);
      color: white;
      padding: 1rem 2rem;
      border-radius: var(--border-radius);
      box-shadow: 0 6px 12px rgba(0,0,0,0.15);
      display: none;
      align-items: center;
      gap: 0.5rem;
      z-index: 1000;
      animation: slideIn 0.5s ease-out;
    }
    
    @keyframes slideIn {
      from { opacity: 0; transform: translateX(100%); }
      to { opacity: 1; transform: translateX(0); }
    }
    
    /* Перемикачі налаштувань і теми */
    .settings-toggle, .theme-toggle {
      position: fixed;
      bottom: 20px;
      background-color: var(--primary-color);
      color: white;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 10px 20px rgba(0,0,0,0.2);
      cursor: pointer;
      transition: var(--transition);
      z-index: 1000;
    }
    
    .settings-toggle { right: 20px; }
    .theme-toggle { right: 100px; }
    
    .settings-toggle:hover, .theme-toggle:hover {
      transform: scale(1.1) rotate(90deg);
      background-color: var(--primary-dark);
    }
    
    .settings-toggle i, .theme-toggle i {
      font-size: 24px;
    }
    
    /* дизайн для секції налаштувань */
    #settings-section {
      display: none;
      position: fixed;
      bottom: 100px;
      right: 20px;
      width: 320px;
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(10px);
      border-radius: var(--border-radius);
      box-shadow: 0 10px 30px rgba(0,0,0,0.15);
      padding: 1.5rem;
      z-index: 1000;
      animation: slideUp 0.3s ease;
      border: 1px solid rgba(0,0,0,0.1);
    }
    
    body.dark #settings-section {
      background: rgba(55, 65, 81, 0.9);
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      border: 1px solid rgba(255,255,255,0.1);
    }
    
    @keyframes slideUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    #settings-section h2 {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 1rem;
      font-size: 1.5rem;
    }
    
    .settings-section .form-group {
      margin-bottom: 1.5rem;
    }
    
    .settings-section label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
    }
    
    .settings-section input,
    .settings-section select {
      width: 100%;
      padding: 0.875rem 1rem;
      border: 2px solid #e2e8f0;
      border-radius: 0.75rem;
      font-size: 1rem;
      transition: var(--transition);
      background: transparent;
      color: inherit;
    }
    
    body.dark .settings-section input,
    body.dark .settings-section select {
      border-color: #4b5563;
    }
    
    .settings-section input:focus,
    .settings-section select:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }
    
    .settings-section button {
      background: var(--primary-color);
      color: white;
      border: none;
      padding: 1rem 2rem;
      border-radius: 0.75rem;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      width: 100%;
    }
    
    .settings-section button:hover {
      background: var(--primary-dark);
      transform: translateY(-1px);
    }
    
    /* АОS анімації */
    [data-aos] {
      opacity: 0;
      transition-property: opacity, transform;
    }
    
    [data-aos].aos-animate {
      opacity: 1;
      transform: translate(0);
    }
    
    /* Медіа-запити */
    @media (max-width: 768px) {
      .container { padding: 1rem; }
      .header h1 { font-size: 2rem; }
      .theme-toggle { right: 80px; }
      #settings-section { width: 90%; right: 5%; }
    }
  </style>
</head>
<body>
  <!-- Заголовок -->
  <header class="header" data-aos="fade-down">
    <div class="container">
      <div class="auth-section">
        <a href="Login.html" class="auth-btn" aria-label="Вийти">
          <i class="fas fa-sign-in-alt" aria-hidden="true"></i> Вийти
        </a>
      </div>
      <div class="header-content">
        <h1>
          <i class="fas fa-shield-alt logo-icon" aria-hidden="true"></i>
          GeoGuard Pro
        </h1>
        <p class="tagline">Глобальна система моніторингу катастроф</p>
        <div class="last-updated" id="last-updated">
          <i class="fas fa-sync-alt" aria-hidden="true"></i>
          <span>Оновлено: Завантаження...</span>
        </div>
      </div>
    </div>
  </header>
  
  <main class="container">
     <!-- Фільтри катастроф -->
    <section class="disaster-filters-section" data-aos="fade-up">
      <h2>
        <i class="fas fa-filter" aria-hidden="true"></i> Фільтр катастроф
      </h2>
      <div class="disaster-filters">
        <div class="filter-card active" data-type="earthquake" tabindex="0" aria-label="Фільтр: Землетруси">
          <div class="filter-icon earthquake">
            <i class="fas fa-mountain" aria-hidden="true"></i>
          </div>
          <span>Землетруси</span>
        </div>
        <div class="filter-card active" data-type="flood" tabindex="0" aria-label="Фільтр: Повені">
          <div class="filter-icon flood">
            <i class="fas fa-water" aria-hidden="true"></i>
          </div>
          <span>Повені</span>
        </div>
        <div class="filter-card active" data-type="volcano" tabindex="0" aria-label="Фільтр: Вулкани">
          <div class="filter-icon volcano">
            <i class="fas fa-meteor" aria-hidden="true"></i>
          </div>
          <span>Вулкани</span>
        </div>
        <div class="filter-card active" data-type="wildfire" tabindex="0" aria-label="Фільтр: Пожежі">
          <div class="filter-icon wildfire">
            <i class="fas fa-fire" aria-hidden="true"></i>
          </div>
          <span>Пожежі</span>
        </div>
      </div>
    </section>
    
   <!-- Період відстеження -->
    <section class="period-filter" data-aos="fade-up">
      <h3>
        <i class="fas fa-clock" aria-hidden="true"></i> Період відслідковування
      </h3>
      <div style="display: flex; gap: 1rem; align-items: center;">
        <select id="tracking-period" class="period-selector" aria-label="Виберіть період відслідковування">
          <option value="3">3 дні</option>
          <option value="7">Тиждень</option>
          <option value="30">Місяць</option>
        </select>
        <button id="refresh-button" class="auth-btn" aria-label="Оновити дані">
          <i class="fas fa-sync-alt" aria-hidden="true"></i> Оновити
        </button>
      </div>
    </section>
    
    <!-- Індикатори катастроф -->
    <section class="disaster-indicators" data-aos="fade-up">
      <div class="indicator-card earthquake">
        <div class="indicator-header">
          <div class="indicator-icon earthquake">
            <i class="fas fa-mountain" aria-hidden="true"></i>
          </div>
          <div>
            <h3>Сейсмічна активність</h3>
            <p class="metric-value">0.0 <span class="metric-unit">балів</span></p>
          </div>
        </div>
        <div class="status-indicator status-normal">
          <div class="status-dot status-normal"></div>
          <span>Аналіз...</span>
        </div>
      </div>
      <div class="indicator-card flood">
        <div class="indicator-header">
          <div class="indicator-icon flood">
            <i class="fas fa-water" aria-hidden="true"></i>
          </div>
          <div>
            <h3>Рівень води</h3>
            <p class="metric-value">0.0 <span class="metric-unit">м</span></p>
          </div>
        </div>
        <div class="status-indicator status-normal">
          <div class="status-dot status-normal"></div>
          <span>Аналіз...</span>
        </div>
      </div>
      <div class="indicator-card volcano">
        <div class="indicator-header">
          <div class="indicator-icon volcano">
            <i class="fas fa-meteor" aria-hidden="true"></i>
          </div>
          <div>
            <h3>Вулкани</h3>
            <p class="metric-value">0 <span class="metric-unit">активних</span></p>
          </div>
        </div>
        <div class="status-indicator status-normal">
          <div class="status-dot status-normal"></div>
          <span>Аналіз...</span>
        </div>
      </div>
      <div class="indicator-card wildfire">
        <div class="indicator-header">
          <div class="indicator-icon wildfire">
            <i class="fas fa-fire" aria-hidden="true"></i>
          </div>
          <div>
            <h3>Пожежі</h3>
            <p class="metric-value">0 <span class="metric-unit">очагів</span></p>
          </div>
        </div>
        <div class="status-indicator status-normal">
          <div class="status-dot status-normal"></div>
          <span>Аналіз...</span>
        </div>
      </div>
    </section>
    
    <!-- Мапа -->
    <section class="map-container" id="disasterMap" aria-label="Карта катастроф" data-aos="fade-in"></section>
    
<!-- Критичні події -->
<section class="critical-events" data-aos="fade-up">
    <div class="container">
      <h2>
        <i class="fas fa-exclamation-triangle" aria-hidden="true"></i> Критичні події
      </h2>
      <div id="critical-events-list" class="critical-events-container">
        <!-- Пример карточки события -->
        <!-- Если есть события, карточки будут добавляться динамически, а если их нет – можно оставить текст-заглушку -->
        <div class="critical-event-card">
           <i class="fas fa-exclamation-circle critical-event-icon" aria-hidden="true"></i>
           <div class="critical-event-title">Нова подія</div>
           <div class="critical-event-description">Деталі події...</div>
        </div>
    
        <p class="no-events">Наразі критичних подій немає</p>
      </div>
    </div>
  </section>
  
  <style>
        /* Загальні стилі для секції критичних подій */
.critical-events {
  padding: 2rem 0;
}

/* Контейнер карток - розташовуємо картки в ряд із перенесенням */
.critical-events-container {
  display: flex;
  flex-wrap: wrap;
  gap: 1.5rem;
  justify-content: center;
  align-items: stretch;
}

/* Якщо подій немає, центруємо повідомлення */
.critical-events-container .no-events {
  flex-basis: 100%;
  text-align: center;
  font-size: 1rem;
  color: #666;
  padding: 1rem;
}

/* Картка події */
.critical-event-card {
  background: var(--card-bg-light);
  border-radius: var(--border-radius);
  padding: 1rem;
  box-shadow: 0 4px 8px rgba(0,0,0,0.1);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  min-width: 200px;
  flex: 1 1 250px; 
  max-width: 300px;
  transition: transform 0.3s, box-shadow 0.3s;
}

/* Темна тема */
body.dark .critical-event-card {
  background: var(--card-bg-dark);
  box-shadow: 0 4px 8px rgba(0,0,0,0.2);
}

/* Hover-ефект для картки */
.critical-event-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 12px 24px rgba(0,0,0,0.2);
}

.critical-event-icon {
  font-size: 2rem;
  color: var(--danger-color);
  margin-bottom: 0.5rem;
}

.critical-event-title {
  font-size: 1.1rem;
  font-weight: 600;
  margin-bottom: 0.5rem;
  text-align: center;
}

.critical-event-description {
  font-size: 0.9rem;
  text-align: center;
  color: #666;
}

body.dark .critical-event-description {
  color: #ccc;
}

  </style>
    
    <!-- Статистика катастроф -->
    <section class="stats-section" data-aos="fade-up">
      <div class="stats-header">
        <h2>
          <i class="fas fa-chart-bar" aria-hidden="true"></i> Статистика катастроф
        </h2>
        <select class="period-selector" id="period-select" aria-label="Оберіть період статистики">
          <option value="day">Добова</option>
          <option value="week">Тижнева</option>
          <option value="month">Місячна</option>
        </select>
      </div>
      <div class="stats-chart-container">
        <canvas id="statsChart" aria-label="Графік статистики"></canvas>
      </div>
    </section>
    
   <!-- Стрічка подій -->
    <section class="disaster-timeline" aria-label="Лента подій" data-aos="fade-up">
      <div class="timeline-event alert-pulse">
        <div class="notification-badge" aria-label="Новий сигнал">!</div>
        <h4>Система активована</h4>
        <p>Останнє оновлення: <span id="live-time"></span></p>
      </div>
    </section>
    
    <!-- Додаткова інформація: інформація про мережу -->
    <section class="additional-info" data-aos="fade-up">
      <div class="ip-geolocation">
        <h2>🌍 Інформація про мережу</h2>
        <div id="network-info">Завантаження...</div>
      </div>
    </section>
  </main>
  
  <!-- Повідомлення про оновлення -->
  <div id="update-notification" role="alert">
    <i class="fas fa-sync-alt fa-spin" aria-hidden="true"></i> Дані оновлюються, зачекайте...
  </div>

  <div class="theme-toggle" id="theme-toggle" aria-label="Переключити тему">
    <i class="fas fa-adjust"></i>
  </div>
  
  <!-- Налаштування -->
  <div class="settings-toggle" id="settings-toggle" aria-label="Налаштування">
    <i class="fas fa-cog"></i>
  </div>
  
  <div id="settings-section" class="settings-section" aria-modal="true">
    <h2>
      <i class="fas fa-cog" aria-hidden="true"></i> Налаштування
    </h2>
    <form id="settings-form">
      <div class="form-group">
        <label for="seismic-threshold">Поріг сейсмічної активності</label>
        <input type="number" id="seismic-threshold" value="4.0" step="0.1" required>
      </div>
      <div class="form-group">
        <label for="water-threshold">Поріг рівня води</label>
        <input type="number" id="water-threshold" value="3.5" step="0.1" required>
      </div>
      <div class="form-group">
        <label for="language-select">Мова</label>
        <select id="language-select">
          <option value="uk">Українська</option>
          <option value="en">English</option>
        </select>
      </div>
      <div class="form-group">
        <label for="notifications-toggle">Отримувати сповіщення</label>
        <input type="checkbox" id="notifications-toggle" checked>
      </div>
      <button type="submit">
        <i class="fas fa-save"></i> Зберегти
      </button>
    </form>
  </div>
  
  <!-- Scripts -->
  <script src="https://unpkg.com/aos@2.3.4/dist/aos.js"></script>
  <script>
    // Ініціалізація AOS для плавної появи елементів
    AOS.init({
      duration: 800,
      easing: 'ease-in-out',
      once: true
    });
    
    // Перемикання видимості налаштувань
    document.getElementById('settings-toggle').addEventListener('click', function() {
      const settingsSection = document.getElementById('settings-section');
      settingsSection.style.display = (settingsSection.style.display === 'block') ? 'none' : 'block';
    });
    
   // Перемикач теми (світла/темна)
    document.getElementById('theme-toggle').addEventListener('click', function() {
      document.body.classList.toggle('dark');
    });
    
     // Оновлення часу в режимі реального часу
    function updateLiveTime() {
      document.getElementById('live-time').textContent = new Date().toLocaleTimeString();
    }
    setInterval(updateLiveTime, 1000);
    
    // Повідомлення про оновлення даних
    function showUpdateNotification() {
      const notif = document.getElementById('update-notification');
      notif.style.display = 'flex';
      setTimeout(() => { notif.style.display = 'none'; }, 3000);
    }
    
    document.getElementById('refresh-button').addEventListener('click', function() {
      showUpdateNotification();

    });
    
    function getIP(json) {
      const networkInfo = document.getElementById('network-info');
      networkInfo.innerHTML = `<p>Ваш IP: ${json.ip}</p>`;
    }
  </script>
</body>
</html>


<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
<script>
document.addEventListener('DOMContentLoaded', () => {
    // Конфігурація API
    const CONFIG = {
        OPENWEATHER_API_KEY: 'bd5e378503939ddaee76f12ad7a97608',
        EONET_API_URL: 'https://eonet.gsfc.nasa.gov/api/v3',
        USGS_API_URL: 'https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary'
    };

      // Стан програми
    const state = {
        activeFilters: new Set(['earthquake', 'flood', 'volcano', 'wildfire']),
        currentData: {},
        markers: [],
        thresholds: {
            seismic: 4.0,
            water: 3.5
        },
        trackingPeriod: 3 // Кількість днів для фільтрації подій (наприклад, 3, 7, 30)
    };

       // Ініціалізація карти
    const map = L.map('disasterMap').setView([30, 0], 2);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

    // Ініціалізація графіка Chart.js
    const statsCtx = document.getElementById('statsChart').getContext('2d');
    let statsChart = new Chart(statsCtx, {
        type: 'bar',
        data: {
            labels: [],
            datasets: [{
                label: 'Кількість подій',
                data: [],
                backgroundColor: '#2563eb',
                borderColor: '#1e40af',
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: { 
                y: { beginAtZero: true } 
            },
            plugins: {
                legend: {
                    display: true,
                    position: 'top'
                },
                title: {
                    display: true,
                    text: 'Статистика подій'
                }
            }
        }
    });

    // Допоміжна функція: повертає дату без часу (початок дня)
    function getStartOfDay(date) {
        const newDate = new Date(date);
        newDate.setHours(0, 0, 0, 0);
        return newDate;
    }

      // Отримання даних про землетруси
    async function getEarthquakeData() {
        try {
            const response = await fetch(`${CONFIG.USGS_API_URL}/4.5_${getUSGSTimeRange()}.geojson`);
            const data = await response.json();
            const periodStart = Date.now() - (state.trackingPeriod * 24 * 60 * 60 * 1000);
            
            return data.features
                .map(quake => ({
                    type: 'earthquake',
                    magnitude: quake.properties.mag,
                    location: {
                        lat: quake.geometry.coordinates[1],
                        lng: quake.geometry.coordinates[0]
                    },
                    title: quake.properties.place,
                    time: new Date(quake.properties.time)
                }))
                .filter(quake => quake.time.getTime() >= periodStart && quake.time.getTime() <= Date.now());
        } catch (error) {
            console.error('Error fetching earthquake data:', error);
            return [];
        }
    }

    // Визначаємо часовий інтервал для USGS API (тиждень або місяць)
    function getUSGSTimeRange() {
        if (state.trackingPeriod <= 7) return 'week';
        if (state.trackingPeriod <= 30) return 'month';
        return 'month';
    }

// Отримання даних з EONET API
    async function getEONETEvents() {
        try {
            const response = await fetch(`${CONFIG.EONET_API_URL}/events`);
            const data = await response.json();
            const periodStart = Date.now() - (state.trackingPeriod * 24 * 60 * 60 * 1000);

            return data.events
                .map(event => {
                    const geometry = event.geometry[event.geometry.length - 1];
                    return {
                        type: getEventType(event.categories[0].id),
                        title: event.title,
                        location: {
                            lat: geometry.coordinates[1],
                            lng: geometry.coordinates[0]
                        },
                        time: new Date(geometry.date)
                    };
                })
                .filter(event => event.time.getTime() >= periodStart && event.time.getTime() <= Date.now());
        } catch (error) {
            console.error('Error fetching EONET data:', error);
            return [];
        }
    }

    // Перетворення ідентифікатора категорії в тип події
    function getEventType(categoryId) {
        const typeMap = {
            'volcanoes': 'volcano',
            'wildfires': 'wildfire',
            'severeStorms': 'flood'
        };
        return typeMap[categoryId] || 'other';
    }

     // Основна функція оновлення UI
    async function updateUI() {
        try {
            const earthquakes = await getEarthquakeData();
            const eonetEvents = await getEONETEvents();
            const allEvents = [...earthquakes, ...eonetEvents];
            state.currentData.events = allEvents;

            updateIndicators(allEvents);
            updateMapMarkers(allEvents);
            updateCriticalEvents(allEvents);

            const now = new Date();
            document.getElementById('live-time').textContent = now.toLocaleTimeString();
            document.getElementById('last-updated').innerHTML = `
                <i class="fas fa-sync-alt"></i> Оновлено: ${now.toLocaleTimeString()}
            `;

            updateStatistics(allEvents);
        } catch (error) {
            console.error('Error updating UI:', error);
        }
    }

    // Оновлення індикаторів (карток)
    function updateIndicators(events) {
        const stats = {
            earthquake: { count: 0, maxMagnitude: 0 },
            volcano: { count: 0 },
            wildfire: { count: 0 },
            flood: { count: 0 }
        };

        const periodStart = Date.now() - (state.trackingPeriod * 24 * 60 * 60 * 1000);

        events.forEach(event => {
            const eventTime = event.time.getTime();
            if (eventTime >= periodStart && eventTime <= Date.now() && state.activeFilters.has(event.type)) {
                if (stats[event.type] !== undefined) {
                    stats[event.type].count++;
                    if (event.type === 'earthquake' && event.magnitude > stats.earthquake.maxMagnitude) {
                        stats.earthquake.maxMagnitude = event.magnitude;
                    }
                }
            }
        });

        document.querySelectorAll('.indicator-card').forEach(card => {
            const type = card.classList[1]; 
            const valueElem = card.querySelector('.metric-value');
            const statusIndicator = card.querySelector('.status-indicator');
            
            if (type === 'earthquake') {
                const magnitude = stats.earthquake.maxMagnitude || 0;
                valueElem.textContent = `${magnitude.toFixed(1)} балів`;
                if (magnitude > state.thresholds.seismic) {
                    card.classList.add('critical', 'alert-pulse');
                    statusIndicator.querySelector('span').textContent = 'Небезпека!';
                } else {
                    card.classList.remove('critical', 'alert-pulse');
                    statusIndicator.querySelector('span').textContent = stats.earthquake.count > 0 ? `Активних: ${stats.earthquake.count}` : 'Норма';
                }
            } else {
                const count = stats[type].count;
                valueElem.textContent = `${count} активних`;
                statusIndicator.querySelector('span').textContent = count > 0 ? `Активних: ${count}` : 'Норма';
            }
        });
    }

        // Оновлення маркерів на карті
    function updateMapMarkers(events) {

        state.markers.forEach(marker => {
            marker.setOpacity(0);
            setTimeout(() => map.removeLayer(marker), 300);
        });
        state.markers = [];

        const periodStart = Date.now() - (state.trackingPeriod * 24 * 60 * 60 * 1000);

        events
            .filter(event => {
                const eventTime = event.time.getTime();
                return (
                    eventTime >= periodStart &&
                    eventTime <= Date.now() &&
                    state.activeFilters.has(event.type)
                );
            })
            .forEach(event => {
                const marker = L.marker([event.location.lat, event.location.lng], {
                    opacity: 0,
                    riseOnHover: true
                })
                .addTo(map)
                .bindPopup(createPopupContent(event));
                
                // Плавна поява маркера
                setTimeout(() => marker.setOpacity(1), 300);
                state.markers.push(marker);
            });
    }

    // Формування вмісту спливаючого вікна для маркера
    function createPopupContent(event) {
        let content = `<b>${event.title}</b><br>`;
        if (event.type === 'earthquake') {
            content += `Магнітуда: ${event.magnitude}<br>`;
        }
        content += `Дата: ${event.time.toLocaleDateString('uk-UA', { year: 'numeric', month: 'long', day: 'numeric' })}<br>`;
        content += `Час: ${event.time.toLocaleTimeString('uk-UA')}`;
        return content;
    }

    // Оновлення статистики в графіку Chart.js з урахуванням обраного режиму агрегації
    function updateStatistics(events) {
        // Режим агрегації вибирається із селектора з id «period-select»
        // Можливі значення: «day» (добова), «week» (тижнева), «month» (місячна)
        const mode = document.getElementById('period-select').value;
        const eventTypes = ['earthquake', 'flood', 'volcano', 'wildfire'];
        let labels = [];
        let datasetsByType = {};
        eventTypes.forEach(type => {
            datasetsByType[type] = [];
        });

        if (mode === "day") {
            // Групування за днями
            const periodDays = state.trackingPeriod;
            const startDate = getStartOfDay(new Date());
            startDate.setDate(startDate.getDate() - periodDays + 1);
            for (let d = 0; d < periodDays; d++) {
                const currentDay = new Date(startDate);
                currentDay.setDate(currentDay.getDate() + d);
                labels.push(currentDay.toLocaleDateString('uk-UA', { day: 'numeric', month: 'short' }));
                eventTypes.forEach(type => {
                    const count = events.filter(event => {
                        if (event.type !== type) return false;
                        const eventDay = getStartOfDay(new Date(event.time));
                        return eventDay.getTime() === currentDay.getTime();
                    }).length;
                    datasetsByType[type].push(count);
                });
            }
        } else if (mode === "week") {
            // Групування по тижнях
            const periodDays = state.trackingPeriod;
            const weeks = Math.ceil(periodDays / 7);
            const startDate = getStartOfDay(new Date());
            startDate.setDate(startDate.getDate() - periodDays + 1);
            for (let w = 0; w < weeks; w++) {
                const weekStart = new Date(startDate);
                weekStart.setDate(weekStart.getDate() + w * 7);
                const weekEnd = new Date(weekStart);
                weekEnd.setDate(weekEnd.getDate() + 7);
                labels.push(`Тиждень ${w + 1}`);
                eventTypes.forEach(type => {
                    const count = events.filter(event => {
                        if (event.type !== type) return false;
                        const eventTime = new Date(event.time);
                        return eventTime >= weekStart && eventTime < weekEnd;
                    }).length;
                    datasetsByType[type].push(count);
                });
            }
        } else if (mode === "month") {
            // Групування за місяцями: групуємо за роком-місяцем
            let groups = {}; // ключ: «YYYY-MM», значення: об'єкт із підрахунками за типами
            events.forEach(event => {
                if (!eventTypes.includes(event.type)) return;
                const date = new Date(event.time);
                const key = `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}`;
                if (!groups[key]) {
                    groups[key] = {};
                    eventTypes.forEach(type => groups[key][type] = 0);
                }
                groups[key][event.type]++;
            });
            labels = Object.keys(groups).sort();
            labels.forEach(key => {
                eventTypes.forEach(type => {
                    datasetsByType[type].push(groups[key][type] || 0);
                });
            });
        }

        // Оновлення даних графіка Chart.js
        statsChart.data.labels = labels;
        statsChart.data.datasets = eventTypes.map(type => ({
            label: type.charAt(0).toUpperCase() + type.slice(1),
            data: datasetsByType[type],
            backgroundColor: getColorForEventType(type),
            borderColor: getColorForEventType(type).replace('0.6', '1'),
            borderWidth: 1
        }));
        statsChart.options.plugins.title = {
            display: true,
            text: `Статистика подій (${mode === "day" ? "Добова" : mode === "week" ? "Тижнева" : "Місячна"})`
        };
        statsChart.update();
    }

    // Отримання кольору для типу події
    function getColorForEventType(type) {
        const colorMap = {
            'earthquake': 'rgba(220, 38, 38, 0.6)',   // Червоний
            'flood': 'rgba(37, 99, 235, 0.6)',         // Синій
            'volcano': 'rgba(245, 158, 11, 0.6)',       // Жовтий
            'wildfire': 'rgba(249, 115, 22, 0.6)'       // Помаранчевий
        };
        return colorMap[type] || 'rgba(0,0,0,0.6)';
    }

    // Оновлення критичних (найбільш небезпечних) подій
    function updateCriticalEvents(events) {
        const container = document.getElementById('critical-events-list');
        container.innerHTML = '';

        // Фільтрація небезпечних подій:
        // - Землетруси з магнітудою вище за поріг
        // - Усі вулканічні та пожежні події вважаються небезпечними
        const dangerousEvents = events.filter(event => {
            if (event.type === 'earthquake') {
                return event.magnitude > state.thresholds.seismic;
            }
            if (event.type === 'volcano' || event.type === 'wildfire') {
                return true;
            }
            return false;
        });

        if (dangerousEvents.length === 0) {
            container.innerHTML = '<p class="no-events">Наразі критичних подій немає</p>';
            return;
        }

        // Сортування подій від нових до старих
        dangerousEvents.sort((a, b) => b.time - a.time);

        dangerousEvents.forEach(event => {
            // Створюємо окремий блок для події
            const eventElem = document.createElement('div');
            eventElem.className = 'critical-event-card';
            
            // Вибір значка і його колір залежно від типу події
            let iconHtml = '';
            if (event.type === 'earthquake') {
                iconHtml = '<i class="fas fa-exclamation-triangle" style="color: #dc2626;"></i>';
            } else if (event.type === 'volcano') {
                iconHtml = '<i class="fas fa-exclamation-triangle" style="color: #eab308;"></i>';
            } else if (event.type === 'wildfire') {
                iconHtml = '<i class="fas fa-exclamation-triangle" style="color: #f97316;"></i>';
            } else {
                iconHtml = '<i class="fas fa-exclamation-circle" style="color: #374151;"></i>';
            }
            
            // Формування вмісту блоку
            let info = `<div class="critical-event-icon">${iconHtml}</div>`;
            info += `<div class="critical-event-info">`;
            info += `<h4>${event.title}</h4>`;
            info += `<p>Тип: ${event.type.charAt(0).toUpperCase() + event.type.slice(1)}</p>`;
            info += `<p>Дата: ${event.time.toLocaleDateString('uk-UA')} ${event.time.toLocaleTimeString('uk-UA')}</p>`;
            if (event.type === 'earthquake') {
                info += `<p>Магнітуда: ${event.magnitude}</p>`;
            }
            info += `</div>`;
            
            eventElem.innerHTML = info;
            container.appendChild(eventElem);
        });
    }

    // Отримання IP та геолокаційної інформації
    async function getIPData() {
        try {
            const response = await fetch('https://ipapi.co/json/');
            const data = await response.json();
            if (data.error) {
                document.getElementById('network-info').innerHTML = `<p>Помилка: ${data.error}</p>`;
            } else {
                const userLocation = { lat: data.latitude, lng: data.longitude };
                const nearestEvent = findNearestEvent(userLocation);
                document.getElementById('network-info').innerHTML = `
                    <p>IP: ${data.ip}</p>
                    <p>Місто: ${data.city}</p>
                    <p>Країна: ${data.country_name}</p>
                    <p>Провайдер: ${data.org}</p>
                    <p>Найближча подія: ${nearestEvent ? nearestEvent.title : 'Немає'}</p>
                    <p>Відстань: ${nearestEvent ? calculateDistance(userLocation, nearestEvent.location) + ' км' : 'Немає'}</p>
                `;
            }
        } catch (error) {
            document.getElementById('network-info').innerHTML = '<p>Помилка: не вдалося отримати дані</p>';
        }
    }

    // Пошук найближчої події до користувача
    function findNearestEvent(userLocation) {
        const events = state.currentData.events || [];
        let nearestEvent = null;
        let minDistance = Infinity;
        events.forEach(event => {
            const distance = calculateDistance(userLocation, event.location);
            if (distance < minDistance) {
                minDistance = distance;
                nearestEvent = event;
            }
        });
        return nearestEvent;
    }

    // Розрахунок відстані між двома координатами (у км)
    function calculateDistance(loc1, loc2) {
        const R = 6371;
        const dLat = (loc2.lat - loc1.lat) * (Math.PI / 180);
        const dLng = (loc2.lng - loc1.lng) * (Math.PI / 180);
        const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                  Math.cos(loc1.lat * (Math.PI / 180)) * Math.cos(loc2.lat * (Math.PI / 180)) *
                  Math.sin(dLng / 2) * Math.sin(dLng / 2);
        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
        return Math.round(R * c);
    }

    // Обробники подій для елементів UI
    document.getElementById('tracking-period').addEventListener('change', function() {
        state.trackingPeriod = parseInt(this.value);
        updateUI();
    });

    document.querySelectorAll('.filter-card').forEach(card => {
        card.addEventListener('click', function() {
            const type = this.dataset.type;
            this.classList.toggle('active');
            if (state.activeFilters.has(type)) {
                state.activeFilters.delete(type);
            } else {
                state.activeFilters.add(type);
            }
            updateUI();
        });
    });

    // При зміні режиму агрегації статистики (добова, тижнева, місячна) оновлюємо графік
    document.getElementById('period-select').addEventListener('change', updateUI);

    document.getElementById('settings-form').addEventListener('submit', (e) => {
        e.preventDefault();
        state.thresholds.seismic = parseFloat(document.getElementById('seismic-threshold').value);
        state.thresholds.water = parseFloat(document.getElementById('water-threshold').value);
        localStorage.setItem('settings', JSON.stringify(state.thresholds));
        updateUI();
    });

    document.getElementById('refresh-button').addEventListener('click', async function() {
        const notification = document.getElementById('update-notification');
        let timeoutId;
        try {
            notification.style.display = 'flex';
            await updateUI();
            timeoutId = setTimeout(() => {
                notification.style.display = 'none';
            }, 500);
        } catch (error) {
            console.error('Помилка оновлення:', error);
            notification.style.display = 'none';
            clearTimeout(timeoutId);
        }
    });

    // Завантаження збережених налаштувань з localStorage
    const savedSettings = localStorage.getItem('settings');
    if (savedSettings) {
        state.thresholds = JSON.parse(savedSettings);
        document.getElementById('seismic-threshold').value = state.thresholds.seismic;
        document.getElementById('water-threshold').value = state.thresholds.water;
    }

    // Первісна ініціалізація
    getIPData();
    updateUI();

    // Автоматичне оновлення даних кожні 5 хвилин
    setInterval(updateUI, 300000);
});
</script>
